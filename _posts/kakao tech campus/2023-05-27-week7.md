---
layout: single
title: "[ì¹´í…Œìº  BE] week7 - ìŠ¤í”„ë§(ì„¸ì…˜, ì˜ˆì™¸ ì²˜ë¦¬, WEBDataBinder ë“±)"
date: 2023-05-27 17:40:30 +0900
categories:
    - kakao tech campus
---

ì´ë²ˆ ì£¼ë¡œ ìŠ¤í”„ë§ ê°•ì˜ëŠ” ë§ˆì§€ë§‰ì´ë„¤ìš”. ì„ íƒê°•ì˜ë¡œ ìŠ¤í”„ë§ ì‹¬í™”ë‘ ìŠ¤í”„ë§ ë¶€íŠ¸ë„ ì¡´ì¬í•˜ë‹ˆê¹Œ ë‚˜ì¤‘ì— ë´ì•¼ê² ì–´ìš”.

ë‹¤ìŒì£¼ë¶€í„°ëŠ” MySQLì„ ë‹¤ë£¬ë‹¤ê³  í•´ìš”.

í•™ìŠµ ì¼ì§€ ì‹œì‘!

## ì¿ í‚¤(Cookie)

http í†µì‹ ì€ `stateless`ì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ì„  ì¶”ê°€ ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤. ì¿ í‚¤ë€ http í†µì‹ ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.

- `ì´ë¦„=ê°’` ìŒìœ¼ë¡œ êµ¬ì„±ëœ ì‘ì€ ì •ë³´
- ì„œë²„ì—ì„œ ìƒì„± í›„ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ì†¡, ë¸Œë¼ìš°ì €ì— ì €ì¥(ìœ íš¨ê¸°ê°„ ì´í›„ ìë™ ì‚­ì œ)
    - ì„œë²„ì— ìš”ì²­ ì‹œ `domain`, `path`ê°€ ì¼ì¹˜(í•˜ìœ„ ê²½ë¡œ í¬í•¨)í•˜ëŠ” ê²½ìš°ì—ë§Œ ìë™ ì „ì†¡ëœë‹¤.
- ASCII ë¬¸ìë§Œ ê°€ëŠ¥

1. ì„œë²„ì—ì„œ ì‘ë‹µí—¤ë”ì— ì¿ í‚¤ë¥¼ ì¶”ê°€í•˜ì—¬ ì „ì†¡í•œë‹¤.  
    ```java
    Cookie cookie = new Cookie("id", "asdf");  // ì¿ í‚¤ ìƒì„±
    cookie.setMaxAge(60*60*24);     // ìœ íš¨ê¸°ê°„ ì„¤ì •(ì´ˆ) ì½”ë“œëŠ” 24ì‹œê°„;í•˜ë£¨
    response.addCookie(cookie);   // ì‘ë‹µì— ì¿ í‚¤ ì¶”ê°€
    ```
    - ì‘ë‹µí—¤ë” ë‚´ìš©  
        ```java
        HTTP/1.1 200
        Set-Cookie: id=asdf; Max-Age=86400; Expires=Tue, 16-Nov-2021 11:12:15 GMT
        //  ì‘ë‹µ í—¤ë”, ì¿ í‚¤,    ìƒëŒ€ ì‹œê°„,          ì ˆëŒ€ ì‹œê°„
        ```
2. ë¸Œë¼ìš°ì €ì— ì €ì¥ëœë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ì˜ ë‹¤ìŒ ìš”ì²­ë¶€í„° ì¿ í‚¤ê°€ ë”°ë¼ê°€ê²Œ ëœë‹¤.

### ì¿ í‚¤ì˜ ë³€ê²½ê³¼ ì‚­ì œ

ê¸°ì¡´ ì¿ í‚¤ì™€ ê°™ì€ ì´ë¦„ì˜ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ê³  ë³€ê²½í•  ë‚´ìš©ì„ ìƒˆë¡œ `set` í•˜ì—¬ ì „ì†¡í•œë‹¤.

```java
Cookie cookie = new Cookie("id", ""); // ë³€ê²½í•  ì¿ í‚¤ì™€ ê°™ì€ ì´ë¦„ ì¿ í‚¤ ìƒì„±
// cookie.setMaxAge(0);  // ì¿ í‚¤ ì‚­ì œ(ìœ íš¨ê¸°ê°„ì„ 0ìœ¼ë¡œ ì„¤ì •)
cookie.setValue(URLEncoder.encode("ì•ˆí˜œì¤€"));
cookie.setDomain("www.jagaldol.dev");
cookie.setPath("/app");
response.addCookie(cookie); // ì‘ë‹µì— ì¿ í‚¤ ì¶”ê°€
```

- ì‚­ì œëŠ” ìœ íš¨ê¸°ê°„ì„ 0ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì´ë£¨ì–´ì§„ë‹¤.

### ì¿ í‚¤ ì½ê¸°

```java
Cookie[] cookies = reqeust.getCookies();

for(Cookie cookie:cookies) {
	String name = cookie.getName();
	String value = cookie.getValue();
}
```

## Session(ì„¸ì…˜)

í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ ì ‘ì†í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì—ê²Œ ì‹ë³„ì(ì„¸ì…˜ID;ì¿ í‚¤)ë¥¼ ë¶€ì—¬í•˜ê³ , ì„œë²„ì—ì„œ ì„¸ì…˜idì— ë”°ë¼ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ ë³´ê´€í•œë‹¤.

- ë¸Œë¼ìš°ì €ë§ˆë‹¤ ê°œë³„ ì €ì¥ì†Œ(session ê°ì²´)ë¥¼ ì„œë²„ì—ì„œ ì œê³µ

> a collection of **related HTTP transactions made by one browser** to one server.

### ì„¸ì…˜ ë©”ì„œë“œ

| ë©”ì„œë“œ | ì„¤ëª… |
| --- | --- |
| String getId() | ì„¸ì…˜ì˜ IDë¥¼ ë°˜í™˜ |
| long getLastAccessedTime() | ì„¸ì…˜ ë‚´ì—ì„œ ìµœê·¼ ìš”ì²­ì„ ë°›ì€ ì‹œê°„ì„ ë°˜í™˜ |
| boolean isNew() | ìƒˆë¡œ ìƒì„±ëœ ì„¸ì…˜ì¸ì§€? í™•ì¸. request.getSession()í˜¸ì¶œ í›„ ì‚¬ìš© |
| void invalidate() | ì„¸ì…˜ ê°ì²´ë¥¼ ì œê±°(ì €ì¥ëœ ê°ì²´ë„ ì§€ì›Œì§„ë‹¤.) |
| void setMaxInactiveInterval(int interval) | ì§€ì •ëœ ì‹œê°„(ì´ˆ) í›„ì— ì„¸ì…˜ì„ ì¢…ë£Œ(ì˜ˆì•½) |
| int getMaxInactiveInterval() | ì˜ˆì•½ëœ ì„¸ì…˜ ì¢…ë£Œ ì‹œê°„ì„ ë°˜í™˜ |

ì†ì„± ê´€ë ¨ ë©”ì„œë“œëŠ” `pageContext`, `request`, `session`, `application`ë“¤ê³¼ ì „ë¶€ **ë™ì¼**í•˜ë‹¤.

| ì†ì„± ê´€ë ¨ ë©”ì„œë“œ | ì„¤ëª… |
| --- | --- |
| void setAttribute(String name, Object value) | ì§€ì •ëœ ê°’(value)ì„ ì§€ì •ëœ ì†ì„± ì´ë¦„(name)ìœ¼ë¡œ ì €ì¥ |
| Object getAttribute(String name) | ì§€ì •ëœ ì´ë¦„(name)ìœ¼ë¡œ ì €ì¥ëœ ì†ì„±ì˜ ê°’ì„ ë°˜í™˜ |
| void removeAttribute(String name) | ì§€ì •ëœ ì´ë¦„(name)ì˜ ì†ì„±ì„ ì‚­ì œ |
| Enumeration getAttributeNames() | ê¸°ë³¸ ê°ì²´ì— ì €ì¥ëœ ëª¨ë“  ì†ì„±ì˜ ì´ë¦„ì„ ë°˜í™˜ |

### ì„¸ì…˜ ì‚¬ìš©

1. ì„¸ì…˜ idë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¶€ì—¬(ì¿ í‚¤ ì „ì†¡; Set-Cookie)
2. í´ë¼ì´ì–¸íŠ¸ì˜ ì´í›„ ìš”ì²­ë¶€í„° ì„¸ì…˜id ì •ë³´ê°€ ìš”ì²­ í—¤ë”ì— ë‹´ê²¨ì§„ë‹¤.
3. ì„œë²„ì—ì„œ ì¼ì¹˜í•˜ëŠ” ì„¸ì…˜ íƒìƒ‰
4. ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©ê°€ëŠ¥

```java
HttpSession session = request.getSession(); // ìš”ì²­ì˜ ì„¸ì…˜ ì •ë³´ í™•ì¸
session.setAttribute("id", "asdf");  // í•´ë‹¹ ì„¸ì…˜ ì €ì¥ì†Œ ì‚¬ìš© ê°€ëŠ¥
```

- ì €ì¥ì†Œ ìƒì„± ë° ì‚­ì œëŠ” ì„¸ì…˜ ì •ë³´ì— ë”°ë¼ ìë™ìœ¼ë¡œ ê´€ë¦¬ëœë‹¤.

### ì„¸ì…˜ ì¢…ë£Œ

- **ìˆ˜ë™ ì¢…ë£Œ**  
    ```java
    HttpSession session = request.getSession();
    session.invalidate();
    ```
- **ìë™ ì¢…ë£Œ - web.xml**  
    ```xml
    <session-config>
    	<session-timeout>30</session-timeout>
    </session-config>
    ``` 
    - ìë™ìœ¼ë¡œ ì„¸ì…˜ì´ ì¢…ë£Œ ë˜ì§€ ì•Šìœ¼ë©´ ë³´ì•ˆ ìƒ ìœ„í—˜ì´ ì¡´ì¬í•œë‹¤.

### ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒ

- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„¸ì…˜ì„ ë§Œë“¤ì–´ ì¤€ë‹¤.
    - í˜„ì¬ëŠ” í•˜ë“œì½”ë”© ë˜ì–´ìˆì§€ë§Œ ë‚˜ì¤‘ì—ëŠ” dbì™€ ì—°ê²°í•˜ì—¬ ë§¤ì¹­ ê²€ìƒ‰ì„ ìˆ˜í–‰í•œë‹¤.
    - ì•„ì´ë”” ê¸°ì–µí•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ ìœ íš¨ê¸°ê°„ì´ ì—†ëŠ” ì¿ í‚¤ë¥¼ ë¸Œë¼ìš°ì €ì—ê²Œ ë„˜ê²¨ì¤˜ ê¸°ì–µí•˜ë„ë¡ í•œë‹¤.
- ë¡œê·¸ì•„ì›ƒ ì‹œ ì„¸ì…˜ì„ íŒŒê¸°í•˜ê³  í™ˆí™”ë©´ìœ¼ë¡œ `redirect`ì‹œí‚¨ë‹¤.

```java
@PostMapping("/login")
public String login(String id, String pwd, String toURL, boolean rememberId,
		HttpServletRequest request, HttpServletResponse response) throws Exception {
	if (!loginCheck(id, pwd)) {
		String msg = URLEncoder.encode("id ë˜ëŠ” pwdê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "utf-8");
		
		return "redirect:/login/login?msg="+msg;
	}
	// ì„¸ì…˜ ìƒì„±
	HttpSession session = request.getSession();
	
	session.setAttribute("id", id);
	
	// ì•„ì´ë”” ê¸°ì–µí•˜ê¸°
	if (rememberId) {
		Cookie cookie = new Cookie("id", id);
		response.addCookie(cookie);			
	} else {
		Cookie cookie = new Cookie("id", id);
		cookie.setMaxAge(0);
		response.addCookie(cookie);
	}
	toURL = toURL == null || toURL.equals("") ? "/" : toURL;
	return "redirect:" + toURL();
}

@GetMapping("/logout")
public String logout(HttpServletRequest request) {
	HttpSession session = request.getSession();
	session.invalidate();
	return "redirect:/";
}

private boolean loginCheck(String id, String pwd) {
	return "asdf".equals(id) && "1234".equals(pwd);
}
```

## ë¡œê·¸ì¸ í›„ ì›ë˜ ê°€ê³ ì í–ˆë˜ í˜ì´ì§€ë¡œ ì´ë™ ì‹œí‚¤ê¸°

- Http requestì—ì„œ fromê³¼ toì˜ ì •ë³´ë¥¼ ì–»ëŠ” ë²•
    - from: `request.getHeader(â€referâ€)`
    - to: `request.getRequestURL()`
    - í•„í„°ë¥¼ ì‚¬ìš©í•´ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ í™•ì¸ì„ í•´ë³´ì  
        ```java
        // 3. í›„ì²˜ë¦¬ ì‘ì—…
        HttpServletRequest req = (HttpServletRequest)request;
        String referer = req.getHeader("referer");
        String method = req.getMethod();
        String requestURI = req.getRequestURI();
        
        System.out.print("["+referer+"] ->"+method+"["+requestURI+"]");
        System.out.println(" ì†Œìš”ì‹œê°„="+(System.currentTimeMillis()-startTime)+"ms");
        ```
        - ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ í•„í„°ë¥¼ ê±¸ì–´ì„œ ì „ë¶€ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.  
        ```bash
        [http://localhost:8080/ch2/] ->GET[/ch2/] ì†Œìš”ì‹œê°„=39ms
        [http://localhost:8080/ch2/] ->GET[/ch2/board/list] ì†Œìš”ì‹œê°„=3ms
        [http://localhost:8080/ch2/] ->GET[/ch2/login/login] ì†Œìš”ì‹œê°„=5ms
        ```
        - **í•„í„° ì „ì²´ ì½”ë“œ**  
            ```java
            // í•„í„°ë¥¼ ì ìš©í•  ìš”ì²­ì˜ íŒ¨í„´ ì§€ì • - ëª¨ë“  ìš”ì²­ì— í•„í„°ë¥¼ ì ìš©.
            @WebFilter(urlPatterns="/*")
            public class PerformanceFilter implements Filter {
            	@Override
            	public void init(FilterConfig filterConfig) throws ServletException {
            		// ì´ˆê¸°í™” ì‘ì—…
            	}
            
            	@Override
            	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            			throws IOException, ServletException {
            		// 1. ì „ì²˜ë¦¬ ì‘ì—…
            		long startTime = System.currentTimeMillis();
            
            		// 2. ì„œë¸”ë¦¿ ë˜ëŠ” ë‹¤ìŒ í•„í„°ë¥¼ í˜¸ì¶œ
            		chain.doFilter(request, response); 
            		
            		// 3. í›„ì²˜ë¦¬ ì‘ì—…
            		HttpServletRequest req = (HttpServletRequest)request;
            		String referer = req.getHeader("referer");
            		String method = req.getMethod();
            		String requestURI = req.getRequestURI();
            		
            		System.out.print("["+referer+"] ->"+method+"["+requestURI+"]");
            		System.out.println(" ì†Œìš”ì‹œê°„="+(System.currentTimeMillis()-startTime)+"ms");
            	}
            
            	@Override
            	public void destroy() {
            		// ì •ë¦¬ ì‘ì—…
            	}
            }
            ```


1. **ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œì˜ `redirect`ì—ì„œ url ì „ë‹¬**  
    ```java
    if (!loginCheck(request))
    	return "redirect:/login/login?toURL="+request.getRequestURL();
    ```

    - toURL íŒŒë¼ë¯¸í„°ë¡œ `request.getRequestURL()`ì„ ì¤€ë‹¤.
2. **ë¡œê·¸ì¸ í™”ë©´ì—ì„œ POST ìš”ì²­ì— í¬í•¨ ì‹œí‚¤ê¸° ìœ„í•œ ìˆ¨ê²¨ì§„ inputíƒœê·¸ ì‘ì„±**  
    ```html
    <input type="text" name="id" value="${cookie.id.value}" placeholder="ì´ë©”ì¼ ì…ë ¥" autofocus>
    <input type="password" name="pwd" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <input type="hidden" name="toURL" value="${param.toURL}">
    ```
3. **loginControllerì—ì„œì˜ redirect ìˆ˜ì •**  
    ```java
    @PostMapping("/login")
    public String login(String id, String pwd, String toURL, boolean rememberId,
    		HttpServletRequest request, HttpServletResponse response) {
    	
    	...
    	
    	toURL = toURL == null || toURL.equals("") ? "/" : toURL;
    	return "redirect:" + toURL;
    }
    ```

    - ìƒˆë¡œìš´ íŒŒë¼ë¯¸í„°ì¸ toURLì„ ì‘ì„±
    - ê°’ì— ë”°ë¼ redirect ìœ„ì¹˜ ìˆ˜ì •

## session=false

ì„¸ì…˜ ì‹œê°„ì„ ì¤„ì—¬ì•¼ ì„œë²„ ë¶€ë‹´ì´ ì¤„ì–´ë“ ë‹¤. ì„¸ì…˜ì´ í•„ìš”ì—†ëŠ” í˜ì´ì§€(ë¡œê·¸ì¸ í™”ë©´, í™ˆí™”ë©´) ë“±ì—ëŠ” `session=false`ë¥¼  í•˜ì.

- jsp íŒŒì¼ ìƒë‹¨ì— ì½”ë“œ ì¶”ê°€  
    ```java
    <%@ page session="false" %>
    ```

> `session=false`ì—¬ë„ ê¸°ì¡´ sessionì´ ìƒì„±ë˜ì–´ìˆì„ ë•Œ sessionì„ ë²„ë¦¬ì§€ëŠ” ì•ŠëŠ”ë‹¤. ë‹¨ì§€ ìƒˆë¡œ ìƒì„±ì„ í•˜ì§€ ì•Šì„ ë¿ì´ë‹¤.

## ì˜ˆì™¸ì²˜ë¦¬

ê° `controller` ë‚´ë¶€ì— `ExcpetionHandler`ë¥¼ ë„£ê±°ë‚˜ ì „ì²´ íŒ¨í‚¤ì§€ì— ì ìš©ì„ ìœ„í•´ `ControllerAdvice`ë¥¼ ì‚¬ìš©í•œë‹¤.

```java
// @ControllerAdvice // ëª¨ë“  íŒ¨ìºì§€ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì ìš©
@ControllerAdvice("com.fastcampus.ch2")	// ì§€ì •ëœ íŒ¨í‚¤ì§€ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì—ê²Œ ì ìš©
public class GlobalCatcher {
	@ExceptionHandler(Exception.class)
	public String catcher(Exception ex, Model m) {
		m.addAttribute("ex", ex);
		return "error";
	}
	
	@ExceptionHandler({NullPointerException.class, FileNotFoundException.class})
	public String catcher2(Exception ex, Model m) {
		m.addAttribute("ex", ex);
		return "error";
	}
}
```

í•´ë‹¹í•˜ëŠ” Exception ë°œìƒ ì‹œ catcherë¡œ ë„˜ì–´ì™€ catcherê°€ ì‹¤í–‰ëœë‹¤.

- jsp í˜ì´ì§€ì—ì„œ `<%@ page isErrorPage='true' %>` ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ ê°ì²´ `excpetion`ì„ ì‚¬ìš© ê°€ëŠ¥í•˜ì—¬ `model`ë¡œ `exception`ì„ ë„˜ê²¨ì£¼ì§€ ì•Šì•„ë„ ëœë‹¤.  
    ```html
    <%@ page contentType="text/html;charset=utf-8" isErrorPage="true"%>
    <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
    <html>
    <head>
    	<title>error.jsp</title>
    </head>
    <body>
    <h1>ì˜ˆì™¸ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</h1>
    ë°œìƒí•œ ì˜ˆì™¸ : ${pageContext.exception}<br>
    ì˜ˆì™¸ ë©”ì‹œì§€ : ${pageContext.exception.message}<br>
    <ol>
    <c:forEach items="${pageContext.exception.stackTrace}" var="i">
    	<li>${i.toString()}</li>
    </c:forEach>
    </ol>
    </body>
    </html>
    ```
    
<div class="notice--danger" markdown="1">
**â—ì£¼ì˜â—** 

`isErrorPage="true"`ë¥¼ ì ìœ¼ë©´ ì‘ë‹µì´ ì „ë¶€ 500(ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜)ë¡œ ëŒì•„ê°„ë‹¤. `@ResponseStatus`ë¡œ ì„¤ì •í•œ ê²ƒì´ ë®ì–´ ì“°ì—¬ì§€ë‹ˆê¹Œ ì£¼ì˜í•  ê²ƒ!
</div>


### @ResponseStatus

ì‘ë‹µ ë©”ì‹œì§€ì˜ ìƒíƒœ ì½”ë“œë¥¼ ë³€ê²½í•  ë•Œ ì‚¬ìš©

```java
@ResponseStatus(HttpStatus.METHOD_NOT_ALLOWED)
@ExceptionHandler(Exception.class)
public String catcher(Exception ex, Model m) {
	m.addAttribute("ex", ex);
	return "error";
}
```

ìš”ì²­ ì²˜ë¦¬ ì„±ê³µìœ¼ë¡œ 200ì˜ ìƒíƒœì½”ë“œê°€ ê°€ë²„ë¦¬ë©´ ë§ì§€ ì•Šë‹¤. ì„ì˜ë¡œ ìƒíƒœì½”ë“œë¥¼ ë¶€ì—¬í•´ì£¼ì–´ì•¼ í•œë‹¤.

### í†°ìº£ì˜ ê¸°ë³¸ error page ë³€ê²½í•˜ê¸°

ê¸°ë³¸ error pageëŠ” ì„œë²„ì˜ ì—ëŸ¬ ì½”ë“œë¥¼ ì „ë¶€ ë‹¤ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì— ë³´ì•ˆ ìƒ ìœ„í—˜ì´ ìƒê¸¸ ìˆ˜ë„ ìˆê³  ì‚¬ìš©ìì—ê²Œ ì¹œí™”ì ì´ì§€ ì•Šë‹¤. ì´ë¥¼ `web.xml`ì„ ìˆ˜ì •í•˜ì—¬ ê¸°ë³¸ í˜ì´ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

- ê¸°ë³¸ error page  
    ![error-500](/assets/images/2023-05-27/error-500.png)
- `web.xml` ì— ì½”ë“œ ì¶”ê°€  
    ```xml
    <error-page>
    	<error-code>400</error-code>
    	<location>/error400.jsp</location>
    </error-page>
    <error-page>
    	<error-code>500</error-code>
    	<location>/error500.jsp</location>
    </error-page>
    ```
- `error400.jsp` ì™€ `error500.jsp` ëŠ” webapp í´ë” ë°‘ì— ë§Œë“¤ì–´ ì¶”ê°€í•œë‹¤.

ì´ë ‡ê²Œ í•˜ë©´, `ExceptionHandler`ë¡œ `catch`í•˜ì§€ ì•Šì•„ë„ ì›í•˜ëŠ” ìƒíƒœì½”ë“œì— ë§ê²Œ ì›í•˜ëŠ” ì—ëŸ¬ í˜ì´ì§€ë¡œ ë³´ì—¬ ì¤„ ìˆ˜ ìˆë‹¤.

> `ExceptionHandler`ë¥¼ ì‚¬ìš©í•œ ê²ƒì€ `try-catchë¬¸`ê³¼ ê°™ê¸° ë•Œë¬¸ì— `web.xml`ë¡œ ì„¤ì •í•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ë˜ì§€ì•ŠëŠ”ë‹¤. ê¸°ë³¸ ì—ëŸ¬ í˜ì´ì§€ëŠ” `Exception`ìœ¼ë¡œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œë§Œ ì´ì–´ì§„ë‹¤.

### SimpleMappingExceptionResolver

ë‹¨ìˆœíˆ `Exception`ì— ëŒ€í•´ ì—ëŸ¬ í˜ì´ì§€ë¥¼ mappingí•  ë•ŒëŠ”, `SimpleMappingExceptionResolver`ë¥¼ ì‚¬ìš©í•´ `servlet-context.xml`ì— ì¶”ê°€í•´ë‘˜ ìˆ˜ ìˆë‹¤.

```html
<beans:bean class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
	<beans:property name="defaultErrorView" value="error"/>
		<beans:property name="exceptionMappings">
			<beans:props>
				<beans:prop key="com.fastcampus.ch2.MyException">error400</beans:prop>
			</beans:props>
		</beans:property>
	<beans:property name="statusCodes">
		<beans:props>
				<beans:prop key="error400">400</beans:prop>
		</beans:props>
	</beans:property>
</beans:bean>
```

### ì˜ˆì™¸ì²˜ë¦¬ ê¸°ë³¸ ì „ëµ

1. `Controller`ì—ì„œ Exception ë°œìƒ
2. `DispatcherServlet`ìœ¼ë¡œ Exception ì „ë‹¬(throws)
3. `handlerExceptionResolvers`ë¥¼ í™•ì¸í•˜ì—¬ í•´ê²° ì‹œë„
    - ê¸°ë³¸ ì „ëµ 3ê°€ì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹œë„
    1. `ExceptionHandlerExceptionResolver`
        - @ExceptionHandler ê°€ ë¶™ì€ handler
    2. `ResponseStatusExceptionResolver`
        - Exceptionì— ë¶™ì–´ ìˆëŠ” @RespnoseStatus í™•ì¸
        - web.xmlì—ì„œ ì—ëŸ¬ì½”ë“œì— í•´ë‹¹í•˜ëŠ” ê²Œ ì¡´ì¬í•˜ëŠ” ì§€ í™•ì¸í•˜ì—¬ viewì „ë‹¬ í•  ìˆ˜ ìˆ
    3. `DefaultExceptionResolver`
        - ìŠ¤í”„ë§ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì •ì˜ë¼ ìˆìŒ
        - ê¸°ë³¸ ì„œë²„ ì—ëŸ¬ëŠ” 500
        - ìƒí™©ì„ íŒë‹¨í•˜ì—¬ 400ë²ˆëŒ€ì™€ 500ë²ˆëŒ€ë¡œ ì ì ˆíˆ ë°”ê¿”ì¤€ë‹¤.

## DispatcherServlet íŒŒí—¤ì¹˜ê¸°

![DispatcherServlet](/assets/images/2023-05-27/DispatcherServlet.png)

- ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ HandlerMappingì—ê²Œ ìš”ì²­ urlì„ ì „ë‹¬í•œë‹¤.
- **HandlerMapping**
    - key-value(url-method)ë¥¼ ë³´ê´€í•˜ì—¬ ë§¤í•‘ì„ í•´ì¤€ë‹¤.
- **HandlerAdapter**
    - ë§¤í•‘ëœ ì •ë³´ë¥¼ í† ëŒ€ë¡œ Adapterë¥¼ ê±°ì³ Controller í˜¸ì¶œ
    - ëŠìŠ¨í•œ ì—°ê²°(ë³€ê²½ì— ìœ ë¦¬)
    - HandlerAdapterëŠ” ì—¬ëŸ¬ê°œ ê°€ëŠ¥í•˜ë‹¤.
    - ì´ê±¸ í†µí•´ì„œ `Controller`ë¿ë§Œ ì•„ë‹ˆë¼ `Servlet`ë„ í˜¸ì¶œê°€ëŠ¥í•˜ë‹¤.
- **ViewResolver**
    - ì „ë‹¬ë°›ì€ ë·° ì •ë³´(return ê°’)ì„ resolverë¥¼ ì‚¬ìš©í•´ ì‹¤ì œ ê°’ ì–»ëŠ”ë‹¤.
    - ê¸°ë³¸ `InternalResourceViewResolver`  
        ```html
        <beans:bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        	<beans:property name="prefix" value="/WEB-INF/views/" />
        	<beans:property name="suffix" value=".jsp" />
        </beans:bean>
        ```
        - ì‹¤ì œ ë·°ê°€ ë¬´ì—‡ì¸ì§€ ë§í•´ì¤€ë‹¤.
- **jstlVIEW**
    - View ì¸í„°í˜ì´ìŠ¤
    - ì—­ì‹œë‚˜ ëŠìŠ¨í•œ ì—°ê²°
- ë·°ë¥¼ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µí•´ì¤€ë‹¤.

### ì†ŒìŠ¤ ë¶„ì„

`DispatcherServlet.class`ëŠ” `spring-webmvc-5.0.7.RELEASE.jar`ì— í¬í•¨ë˜ì–´ ìˆë‹¤.

- **ì†ŒìŠ¤íŒŒì¼ ìœ„ì¹˜** - `org/springframework/web/servlet/DispatcherServlet.java`
- **ê¸°ë³¸ ì „ëµ** - `org/springframework/web/servlet/DispatcherServlet.properties`
- **ì£¼ìš” ë©”ì„œë“œë“¤**  

    | ë©”ì„œë“œ | ì„¤ëª… |
    | --- | --- |
    | void initStrategies(ApplicationContext context) | ê¸°ë³¸ ì „ëµì„ ì´ˆê¸°í™” |
    | void doService(~) | doDispatch() í˜¸ì¶œ |
    | void doDispatch(~) | ì‹¤ì œ ìš”ì²­ì„ ì²˜ë¦¬ |
    | void processDispatchResult(~, <br>&nbsp;&nbsp;&nbsp;&nbsp;HandlerExecutionChain mappedHandler) | ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸í•˜ê³ , ë°œìƒí•˜ì§€ ì•Šì•˜ìœ¼ë©´ render()ë¥¼ í˜¸ì¶œ |
    | void render(ModelAndView mv, ~) | ì‘ë‹µê²°ê³¼ë¥¼ ìƒì„±í•´ì„œ ì „ì†¡ |

    - `HttpServletRequest request, HttpServletResponse response` ëŠ” ~ë¡œ ìƒëµí•¨

## WebDataBinder

**íƒ€ì…ë³€í™˜**ê³¼ **ë°ì´í„° ê²€ì¦**ì„ ìˆ˜í–‰í•œë‹¤.

- `String`ìœ¼ë¡œ ë°›ì€ ë°ì´í„°ë¥¼ `íƒ€ì… ë³€í™˜`
- ë°ì´í„°ì˜ ì„¸ë¶€ì ì¸ ê²€ì¦ (e.g. dayì€ 31 ì´í•˜ ì—¬ì•¼ í•œë‹¤.)
- ê°ê°ì˜ ê²°ê³¼ì™€ ì—ëŸ¬ë¥¼ `BindingResult`ì— ë³´ê´€
- ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œì— ë§¤ê°œë³€ìˆ˜ë¡œ `BindingReuslt` ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
    - **(ì£¼ì˜)**ë°”ì¸ë”©í•  ê°ì²´ ë°”ë¡œ ë’¤ì— ì™€ì•¼ í•œë‹¤.

    ```java
    @PostMapping("/register/save")
    public String save(User user, BindingResult result) {
    	System.out.println("result="+result);
    	
    	...
    
    }
    ```
    
    - `BindingResult`ë¥¼ ì ìœ¼ë©´ ë°”ì¸ë”© ê³¼ì •ì—ì„œ ì—ëŸ¬ ë°œìƒ ì‹œ ì„œë²„ ì—ëŸ¬ë¥¼ ë‚´ë³´ë‚´ëŠ” ëŒ€ì‹ , ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê°ì²´ëŠ” `null`ë¡œ ì²˜ë¦¬ë˜ê³  ì—ëŸ¬ ë‚´ìš©ì´ resultì— ë‹´ê²¨ ì²˜ë¦¬ëœë‹¤. ì •ìƒ ë¦¬í„´ì´ ê°€ëŠ¥í•˜ë‹¤!

### íƒ€ì… ë³€í™˜

- Controller ë‚´ë¶€ì— `@InitBinder`ë¥¼ ë§Œë“¤ì–´ íƒ€ì… ë³€í™˜ì„ ì„¤ì •í•´ì¤€ë‹¤.  
    ```java
    @InitBinder
    public void toDate(WebDataBinder binder) {
    	SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd");
    	binder.registerCustomEditor(Date.class, new CustomDateEditor(df, false));
    	binder.registerCustomEditor(String[].class, "hobby", new StringArrayPropertyEditor("#"));
    }
    ```
    
    - ë‚ ì§œ ì…ë ¥ì„ `yyy-MM-dd` í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë°›ì•„ Date ê°ì²´ë¡œ ë³€í™˜
    - íŠ¹ì • ì´ë¦„(â€hobbyâ€)ë¥¼ `#`ìœ¼ë¡œ êµ¬ë¶„í•´ì„œ stringë°°ì—´ë¡œ ë³€í™˜
- ë°”ì¸ë”©í•  í•„ë“œ ì•ì— `Formatter`ë¥¼ ë¶™ì¸ë‹¤.  
    ```java
    public class User {
    	...
    	@DateTimeFormat(pattern="yyyy-MM-dd")
    	private Date birth;
    	private String[] hobby;
    
    	...
    }
    ```
- **íƒ€ì…ë³€í™˜ ì¢…ë¥˜**
    - **PropertyEditor**
        - ì–‘ë±¡í–¥ íƒ€ì… ë³€í™˜(String â†” íƒ€ì…)
        - íŠ¹ì • íƒ€ì…ì´ë‚˜ ì´ë¦„ì˜ í•„ë“œì— ì ìš© ê°€ëŠ¥
    - **Converter**
        - ë‹¨ë°©í–¥ íƒ€ì… ë³€í™˜(íƒ€ì…A â†’ íƒ€ì…B)
        - PropertyEditorì˜ ë‹¨ì ì„ ê°œì„ (stateful â†’ stateless)
        - ConversionServiceì— ë“±ë¡í•´ì•¼í•œë‹¤.
    - **Formatter**
        - ì–‘ë°©í–¥ íƒ€ì… ë³€í™˜
        - ë°”ì¸ë”©í•  í•„ë“œì— ì ìš© - `@DateTimeFormat`
        - ì¸í„°í˜ì´ìŠ¤
    
<div class="notice--info" markdown="1">
ì•„ë‹ˆë©´ ë‹¨ìˆœíˆ ê°œë³„ì ì¸ setterë¥¼ ìˆ˜ì •í•  ìˆ˜ë„ ìˆë‹¤!

```java
public void setBirth(String birth) {
    String[] split_birth = birth.split("-");
    System.out.println(Arrays.toString(split_birth));
    this.birth = new Date(Integer.parseInt(split_birth[0]) - 1900,
            Integer.parseInt(split_birth[1]) - 1, Integer.parseInt(split_birth[2]));
}
```

- Stringìœ¼ë¡œ ë°›ì€ parameterë¥¼ ìˆ˜ì •í•˜ì—¬ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- **(ì°¸ê³ )**DateëŠ” ê¸°ë³¸ ë…„ë„ê°€ 1900ìœ¼ë¡œ ë˜ì–´ìˆì–´ 1900ì„ ë¹¼ì•¼ í•œë‹¤ê³  í•œë‹¤.
- ìë°”ì˜ Date ê°ì²´ëŠ” Deprecatedë¼ ê¶Œì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ëŒ€ì‹  Calendarë¼ëŠ” ê°ì²´ê°€ ìˆë‹¤ê³  í•œë‹¤.
</div>
    

### ë°ì´í„° ê²€ì¦

- **Validator**
    - ê°ì²´ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤

    ```java
    public class UserValidator implements Validator {
    
    	@Override
    	public boolean supports(Class<?> clazz) {
    		return User.class.equals(clazz);
    	}
    
    	@Override
    	public void validate(Object target, Errors errors) { 
    		User user = (User)target;
    		
    		String id = user.getId();
    		
    //		if(id==null || "".equals(id.trim())) {
    //			errors.rejectValue("id", "required");
    //		}
    		ValidationUtils.rejectIfEmptyOrWhitespace(errors, "id",  "required");
    		ValidationUtils.rejectIfEmptyOrWhitespace(errors, "pwd", "required");
    		
    		if(id==null || id.length() <  5 || id.length() > 12) {
    			errors.rejectValue("id", "invalidLength");
    		}
    	}
    }
    ```
    
    - **supports**
        - ì–´ë–¤ ê°ì²´ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ì§€ì›í• ì§€ ì—¬ë¶€ë¥¼ ì •í•œë‹¤.
        - ì—¬ê¸°ì„œëŠ” User í´ë˜ìŠ¤ì¸ ê°ì²´ë¥¼ ê²€ì¦í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤.
    - **validate**
        - targetìœ¼ë¡œ ê°ì²´ë¥¼ ë°›ëŠ”ë‹¤.(supportsì—ì„œ í™•ì¸í•˜ì˜€ê¸°ì— instanceof í•„ìš”X)
        - validationìœ¼ë¡œ í‹€ë¦° ë‚´ìš©ì€ errorsì— ì§‘ì–´ë„£ëŠ”ë‹¤.
            - `errors.reject(String errorCode)`
            - `errors.reject(String field, String errorCode)` ë“± ì¡´ì¬
- **ë©”ì„œë“œì—ì„œ ìˆ˜ë™ ì‚¬ìš©**  
    ```java
    @PostMapping("/register/save")
    public String save(User user, BindingResult result) {
    	
    	// ìˆ˜ë™ ê²€ì¦ - validator ì§ì ‘ ìƒì„± ë° validate()ë¥¼ í†µí•œ ê²€ì¦
    	UserValidator userValidator = new UserValidator();
    	userValidator.validate(user, result);
    	
    	// User ê°ì²´ë¥¼ ê²€ì¦í•œ ê²°ê³¼ ì—ëŸ¬ê°€ ìˆìœ¼ë©´, registerFormì„ ì´ìš©í•´ ì—ëŸ¬ ì¶œë ¥
    	if (result.hasErrors()) {
    		return "registerForm";
    	}
    	
    	return "registerInfo";
    }
    ```
    
    - ë©”ì„œë“œ ë‚´ì—ì„œ validator ê°ì²´ë¥¼ ë§Œë“¤ì–´ `validate`ë¥¼ ìˆ˜í–‰í•œë‹¤. ì—ëŸ¬ëŠ” `result`ì— ë‹´ê¸´ë‹¤.
- **WebDataBinderë¡œ ìë™ ì‚¬ìš©**  
    ```java
    @InitBinder
    public void dataBinder(WebDataBinder binder) {
    	binder.setValidator(new UserValidator()); // ë¡œì»¬ validatorë¡œ ë“±ë¡
    //	binder.addValidators(new UserValidator()); // ê¸€ë¡œë²Œ validatorì— ë”í•´ì„œ ì‚¬ìš©
    }
    ```
    
    - íƒ€ì…ë³€í™˜ì²˜ëŸ¼ Controllerë‚´ì˜ `@InitBinder`ì— ì‘ì„±í•œë‹¤.
    
    ```java
    @PostMapping("/register/save")
    public String save(@Valid User user, BindingResult result) {
    	...
    }
    ```
    
    - ê°ì²´ ì•ì— `@Valid`ë¥¼ ë¶™ì´ë©´ ìë™ìœ¼ë¡œ ë“±ë¡ëœ `validator`ë¥¼ ìˆ˜í–‰í•œë‹¤.
    - **ê¸€ë¡œë²Œ validator**
        - ë™ì¼í•˜ê²Œ validator í´ë˜ìŠ¤ë¥¼ ë§Œë“  í›„ servlet-context.xmlì— ì¶”ê°€í•œë‹¤.  
            ```xml
            <annotation-driven validator="globalValidator"/>
            <beans:bean id="globalValidator" class="com.fastcampus.ch2.GlobalValidator"/>
            ```



## âœï¸ì—¬ë‹´

ìƒê°ë³´ë‹¤ ë‚´ìš©ì´ ë°©ëŒ€í•˜ë„¤ìš”. í•µì‹¬ë§Œ ì ì„ë ¤ê³  í–ˆëŠ”ë° ë°°ìš´ë‚´ìš© ìµœëŒ€í•œ ë‚˜ì¤‘ì— ì“°ê¸° ì¢‹ê²Œ ì •ë¦¬í•œë‹¤ëŠ”ê²Œ ë„ˆë¬´ ê¸¸ì–´ì¡Œì–´ìš”...!! ì–´ì©” ìˆ˜ ì—†ì£ . ê·¸ë§Œí¼ ë§ì´ ë°°ì› ë‹¤ëŠ” ì†Œë¦¬ë‹ˆê¹ìš”.

í¬ìŠ¤íŒ…ì„ ì—¬ëŸ¬ê°œë¡œ ìª¼ê°¤ê¹Œ ìƒê°ë„ í–ˆëŠ”ë° ì£¼ì°¨ë³„ë¡œ í¬ìŠ¤íŒ…í•˜ëŠ”ê²Œ ì¢‹ì•„ì„œ ê·¸ëƒ¥ í†µì§¸ë¡œ í–ˆê±°ë“ ìš”. ê·¸ëŸ°ë° ì´ì œì™€ì„œ ìƒê°í•´ë³´ë©´ week7(1), week7(2)ë¡œ ë‚˜ëˆ„ëŠ”ê²ƒë„ ê´œì°®ì•˜ì„ ê±° ê°™ë„¤ìš”ğŸ¤£ ì´ë¯¸ ë‹¤ ì¨ë²„ë ¸ìœ¼ë‹ˆê¹Œ ì´ëŒ€ë¡œ í¬ìŠ¤íŒ…!